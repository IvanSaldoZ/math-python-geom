---
date: 
author:
- И.С. Сальдиков
title: Модификация проекта «Выпуклая оболочка»
---

### Постановка задачи

В этих заданиях требуется модифицировать текст эталонного проекта так,
 как этого требует конкретная постановка задачи. 
 При этом решение обязательно должно быть индуктивным.

### Задача №73
```
Вычисляется площадь части выпуклой оболочки, расположенной внутри 
заданного стандартного замкнутого прямоугольника — прямоугольника со сторонами, 
 параллельными осям координат. Прямоугольник задаётся двумя его
  противоположными вершинами — различными точками плоскости.
```

Необходимо модифицировать код эталонного проекта таким образом, чтобы
программа вычисляла площадь выше.

### Обсуждение идеи решения

Добавим класс прямоугольника `Rectangle` (поместим его в файл `rectangle.py`),
чтобы удобнее было работать. В этот класс поместим все методы, с помощью
 которых будем искать искомые значения площади (и даже немного больше - периметр например).
Например, общая площадь будет храниться именно в этом классе. 
Для данного класса мы реализуем такой же Deq, как и для Figure,
общих точек, из которых состоит общая площадь. Поскольку мы уже знаем, как работать с 
площадью выпуклой оболочки, то для прямоугольника будет то же самое.

Для связи нашего класса, импортируем его в `convex.py`.
Метод `g_73` (так мы назовём метод, который будет возвращать требуемую 
площадь из класса `Rectangle`)
 должен возвращать `0` для нульугольника, одноугольника и
двуугольника, так как в этом
случае площадь всегда равна нулю.
Для многоугольника этот метод будет возращать значение из класса `Rectangle`. 

В тесты необходимо добавить несколько методов, которые будут иллюстрировать
правильность выполненной модификации. Были рассмотрены различные выпуклые 
формы и расположения этих форм, чтобы можно было предварительно сказать,
правильно ли считаем программа (были составлены простые геометрические
фигуры на бумаге).


### Первый этап — работа с одноугольником и двуугольником

Целесообразно начать с изменения тестов — это позволит затем проверить
(хотя бы до некоторой степени) корректность модификации кода этих
двух классов.

#### Модификация тестов

В методы `setup_method` необходимо добавить инициализацию `Rectangle`,
чтобы можно было с ним работать. По каким-то причинам приходится 
переинициализировать данный класс перед вызовом каждого метода теста.

Добавлены 10 методов для проверки правильности расчета площади: для 
разных расположенй фигур, размеров, пересечений и т.д. Новые тесты
имеют название, начинающееся с `test_g73_`

> Рекомендуется нарисовать (на бумаге) картинку. Она поможет понять тесты.

#### Модификация кода

В класс `Figure` добавим метод `g73`, который и будет выводить решение 
задачи под номером 73: общую площадь прямоугольника и выпуклой оболочки.
Также добавляем здесь класс `Rectangle` для расчета общей площади.

Класс `Rectangle` реализует добавление общих точек с учетом того, что
точки не могут повторяться. Для этого был модифицирован класс `Deq`, чтобы
можно было искать внутри дека точки:
```python
def __iter__(self):
    yield from self.array
```
При добавлении точки в методах `Polygon`, `Segment`, `Point` необходимо 
проверять, есть ли пересечение между новыми линиями и границами прямоугольника.
Это реализовано в методе `add_crossing` класса `Rectangle`. 
Поиск точек пересечение отрезков основано на методе из файла `r2point.py`.
Перебирается каждое ребро прямоугольника на поиск пересечения границы 
прямоугольника с новыми ребрами выпуклой оболочки.

При этом, если точек пересечения нет, то это не значит, что общей площади нет, 
потому что возможно ещё:
- Вершины прямоугольника находятся внутри выпуклой оболочки: и тогда сама 
эта вершина и будет общей точкой, внутри границ которой нужно будет считать общую 
площадь.
- Новая точка выпуклой оболочки лежит внутри прямоугольника (прямоугольник 
снаружи точки): и тогда добавляем это точку в общий список.  

Первый случай проверяется методом `add_inside` класса `Rectangle`.
Перебирается каждая вершина прямоугольника на поиск того, лежит ли точка
внутри нового прямоугольника.
  
Второй случай проверяется методом `add_outside` класса `Rectangle`.
Перебирается каждая вершина прямоугольника на поиск того, лежит ли точка
внутри нового прямоугольника.
  

#### Запуск тестов

Убеждаемся в правильности выполненной модификации, выполняя команду

    python -B -m pytest -p no:cacheprovider tests 
 

#### Модификация кода

Результат — в файлах `convex.py`, `rectangle.py`, `deq.py`, `r2point.py`,
`run_tk_convex.py`, `run_convex.py`.
 
### Третий этап — модификация файлов запуска

В файлах `run_convex.py` и `run_tk_convex.py` кроме добавления печати
значений вычисляемого метода `g73` необходимо обеспечить ввод координат
точек, которые будут являться вершинами прямоугольника.